<!DOCTYPE html>
<html lang="en">
<head>
</head>
<body>
	<div id="canvas-container" class="canvas-app-canvas-container" merge="keep">
		<div id="defold-loading-screen" class="canvas-app-loading-screen">
			<div id="defold-background" class="canvas-app-canvas-background"></div>
			<div id="defold-logo" class="canvas-app-canvas-logo">
				<div id="defold-progress" class="canvas-app-progress">
					<div id="defold-progress-bar" class="canvas-app-progress-bar" style="transform: scaleX(0.0);"></div>
				</div>
			</div> 
		</div>
		<canvas id="canvas" class="canvas-app-canvas" tabindex="1" width="{{display.width}}" height="{{display.height}}"></canvas>
	</div>
	<script id='engine-loader' type='text/javascript' src="fast_average_color.min.js"></script>
	<script id='engine-start' type='text/javascript' merge="keep">
		var runningFromFileWarning = document.getElementById("running-from-file-warning");
		if (window.location.href.startsWith("file://")) {
			runningFromFileWarning.style.display = "block";
		}
		else {
			var defold_logo = document.getElementById("defold-logo");
			var defold_logo_image_url = window.getComputedStyle(defold_logo).backgroundImage
				.trim()
				.replace(/^url\(['"](.+)['"]\)$/, '$1');
		  
			var fac = new FastAverageColor();
			  fac.getColorAsync(defold_logo_image_url, {
				  algorithm: 'dominant', 
				  ignoredColor: [0, 0, 0, 0]
			  })
				.then(color => {
					var defold_background = document.getElementById("defold-background");
					defold_background.style.backgroundColor = color.rgb;
				})
				.catch(e => {
					console.log(e);
				});
	
			fac.getColorAsync(defold_logo_image_url, {
				algorithm: 'sqrt', 
				ignoredColor: [0, 0, 0, 0]
			})
				.then(color => {
					var bar = document.getElementById(ProgressView.bar_id);
					bar.style.backgroundColor = color.rgb;
				})
				.catch(e => {
					console.log(e);
				});
				
				ProgressView.addProgress = function() {
					ProgressView.bar = document.getElementById(ProgressView.bar_id);
					ProgressView.progress = document.getElementById(ProgressView.progress_id);
				}
			
			ProgressView.removeProgress = function() {
				var loading_screen = document.getElementById("defold-loading-screen");
				if (loading_screen !== null) {
					loading_screen.remove();
				}
			}
			
			EngineLoader.load("canvas", "{{exe-name}}");
			runningFromFileWarning.parentNode.removeChild(runningFromFileWarning);
		}
	</script>
	<script>
		console.log('hello')
	</script>
</body>
</html>
